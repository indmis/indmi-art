<!-- Библиотека Luminous (Inline-версия для стабильности 2026) -->
<style>
/* Базовые стили Luminous */
@keyframes lum-fadein{0%{opacity:0}to{opacity:1}}@keyframes lum-fadeout{0%{opacity:1}to{opacity:0}}@keyframes lum-fadeYin{0%{opacity:0;transform:translateY(-40px)}to{opacity:1;transform:translateY(0)}}@keyframes lum-fadeYout{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-40px)}}.lum-lightbox{position:fixed;display:none;top:0;right:0;bottom:0;left:0;z-index:10000;cursor:zoom-out}.lum-lightbox.lum-open{display:block}.lum-lightbox-background{position:absolute;top:0;right:0;bottom:0;left:0;background:rgba(0,0,0,.9);animation:lum-fadein .4s ease}.lum-lightbox-inner{position:absolute;top:0;right:0;bottom:0;left:0;display:flex;align-items:center;justify-content:center;animation:lum-fadeYin .4s ease}.lum-lightbox-inner img{max-width:90vw;max-height:90vh;box-shadow:0 0 30px rgba(0,0,0,.5);cursor:default}
</style>

<script>
/**
 * Мини-версия Luminous
 */
!function(){"use strict";function e(t,i){return this instanceof e?(this.el=t,this.options=i||{},void this._init()):new e(t,i)}e.prototype._init=function(){var e=this;this.el.addEventListener("click",function(t){t.preventDefault(),e.open()})},e.prototype.open=function(){var e=this,t=document.createElement("div");t.className="lum-lightbox",t.innerHTML='<div class="lum-lightbox-background"></div><div class="lum-lightbox-inner"><img src="'+this.el.getAttribute("href")+'"></div>',document.body.appendChild(t),t.classList.add("lum-open"),t.addEventListener("click",function(){t.classList.remove("lum-open"),setTimeout(function(){t.remove()},400)})},window.Luminous=e}();

/**
 * Инициализация всех систем при загрузке DOM
 */
document.addEventListener("DOMContentLoaded", function() {
    
    // 1. ЛОГИКА РАНДОМА ОБЛОЖЕК В РАЗДЕЛАХ (Инсталляция, Фото и т.д.)
    // Ищет плитки разделов, в которых мы подготовили .cover-pool через Hugo
    const sectionCards = document.querySelectorAll('.project-card');
    sectionCards.forEach(card => {
        const pool = card.querySelectorAll('.cover-pool span');
        const img = card.querySelector('.dynamic-cover');
        
        if (pool.length > 0 && img) {
            // Выбираем случайное изображение из всех вложенных проектов этого раздела
            const randomIndex = Math.floor(Math.random() * pool.length);
            const randomSrc = pool[randomIndex].innerText;
            if (randomSrc) {
                img.src = randomSrc;
            }
        }
    });

    // 2. РАНДОМ ДЛЯ ГЛАВНОЙ (Случайные 3 проекта из пула)
    const mainPool = document.querySelectorAll('#projects-pool .p-item');
    const display = document.getElementById('glitch-display');
    
    if (mainPool.length > 0 && display) {
        // Перемешиваем массив проектов
        let shuffled = Array.from(mainPool).sort(() => 0.5 - Math.random());
        // Берем первые 3 уникальных проекта
        shuffled.slice(0, 3).forEach(project => {
            const card = document.createElement('div');
            card.className = 'glitch-card';
            card.innerHTML = `
                <a href="${project.dataset.url}">
                    <div class="glitch-img-wrap">
                        <img src="${project.dataset.img}" alt="${project.dataset.title}" loading="lazy">
                    </div>
                    <h3>${project.dataset.title}</h3>
                </a>
            `;
            display.appendChild(card);
        });
    }

    // 3. ИНИЦИАЛИЗАЦИЯ LIGHTBOX (После того как рандом отработал)
    // Находим все ссылки на картинки в контенте и в созданных рандомных карточках
    const initLightbox = () => {
        const images = document.querySelectorAll('.post-content a[href$=".jpg"], .post-content a[href$=".png"], .post-content a[href$=".webp"], .photo-grid a, .glitch-card a[href$=".jpg"]');
        if (window.Luminous) {
            images.forEach(function(el) {
                new Luminous(el);
            });
        }
    };
    
    initLightbox();
});
</script>
