{{- define "main" -}}

{{- if or (.IsHome) (eq .RelPermalink "/indmi-art/") -}}
    {{/* --- КОД ДЛЯ ГЛАВНОЙ (БЕЗ ИЗМЕНЕНИЙ) --- */}}
    <div class="profile">
        <div class="profile_inner">
            <h1>{{ .Site.Params.profileMode.title | default "Indmi Art" }}</h1>
            <span>{{ .Site.Params.profileMode.subtitle | safeHTML }}</span>
            <div class="social-icons"></div>
            <div class="buttons">
                {{- range .Site.Params.profileMode.buttons }}
                <a class="button" href="{{ .url | relURL }}" rel="noopener" title="{{ .name }}">
                    <span class="button-inner">{{ .name }}</span>
                </a>
                {{- end }}
            </div>
        </div>
    </div>

    <div id="projects-pool" style="display: none;">
        {{- range .Site.RegularPages -}}
            {{- if in .RelPermalink "/posts/" -}}
                {{- $img := "" -}}
                {{- if .Params.cover.image -}}
                    {{- $resource := .Resources.GetMatch .Params.cover.image -}}
                    {{- if $resource -}} {{ $img = $resource.RelPermalink }} {{- end -}}
                {{- end -}}
                <div class="p-item" data-url="{{ .RelPermalink }}" data-title="{{ .Title }}" data-img="{{ $img }}"></div>
            {{- end -}}
        {{- end -}}
    </div>
    <div id="glitch-display" class="random-projects-container"></div>

{{- else -}}
    {{/* --- КОД ДЛЯ СТРАНИЦ СПИСКОВ (ПРОЕКТЫ, ИНСТАЛЛЯЦИИ И Т.Д.) --- */}}
    <header class="page-header">
        <h1>{{ .Title }}</h1>
        {{- if .Description }}<div class="post-description">{{ .Description }}</div>{{- end }}
    </header>

    {{- if .Content }}
    <div class="post-content">{{ .Content }}</div>
    {{- end }}

    {{/* ВОЗВРАЩАЕМ СТАНДАРТНЫЙ ЦИКЛ PAPERMOD */}}
    {{- $pages := .Paginator.Pages -}}
    {{- range $pages }}
    <article class="post-entry">
        {{- $header_class := "" -}}
        {{- if (.Param "ShowPostNavLinks") }} {{ $header_class = "entry-header" }} {{- end }}
        <header class="{{ $header_class }}">
            <h2>{{ .Title }}</h2>
        </header>
        {{- if (index .Params "cover") -}}
            {{- partial "cover.html" (dict "cxt" . "IsSingle" false "IsHome" false) -}}
        {{- end }}
        <section class="entry-content">
            <p>{{ .Summary | plainify | htmlUnescape }}{{ if .Truncated }}...{{ end }}</p>
        </section>
        <footer class="entry-footer">
            {{- partial "post_meta.html" . -}}
        </footer>
        <a class="entry-link" aria-label="post link to {{ .Title | plainify }}" href="{{ .RelPermalink }}"></a>
    </article>
    {{- end }}

    {{/* Пагинация (если проектов будет очень много) */}}
    {{- if gt .Paginator.TotalPages 1 }}
    <footer class="page-footer">
        <nav class="pagination">
            {{- if .Paginator.HasPrev }}
            <a class="prev" href="{{ .Paginator.Prev.URL | relURL }}">« Prev</a>
            {{- end }}
            {{- if .Paginator.HasNext }}
            <a class="next" href="{{ .Paginator.Next.URL | relURL }}">Next »</a>
            {{- end }}
        </nav>
    </footer>
    {{- end }}

{{- end -}}
{{- end -}}
